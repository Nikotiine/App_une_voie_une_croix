<div class="site-view" *ngIf="site">
  <h1 class="title has-text-centered">{{ site.name }}</h1>
  <p-tabView>
    <p-tabPanel>
      <ng-template pTemplate="header">
        <span class="">
          <i class="{{ ICON.INFORMATION }} mr-2"></i>Informations
          generales</span
        >
      </ng-template>
      <div class="is-flex is-flex-direction-column">
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.ROUTE_NUMBER }} mr-1"></i>{{ routeNumberSummary }}
          </span>
          {{ site.averageRouteNumber }}
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.EXPOSITION }} mr-1"></i>{{ expositionSummary }}
          </span>
          <span *ngFor="let expo of site.expositions" class="mr-1">{{
            expo.label
          }}</span>
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.ROCK_TYPE }} mr-1"></i>{{ rockTypeSummary }}</span
          >{{ site.rockType.label }}
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.MIN_LEVEL }} mr-1"></i>{{ minLevelSummary }}
          </span>
          {{ site.minLevel.label }}
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.MAX_LEVEL }} mr-1"></i>{{ maxLevelSummary }}
          </span>
          {{ site.maxLevel.label }}
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.ROUTE_HEIGHT }} mr-1"></i>
            {{ routeHeightSummary }}
          </span>
          {{ site.averageRouteHeight }} metres
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.ROUTE }} mr-1"></i> {{ routeProfileSummary }}
          </span>

          <span *ngFor="let profile of site.routeProfiles" class="mr-1">{{
            profile.label
          }}</span>
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.EQUIPMENT }} mr-1"></i> {{ equipmentSummary }}
          </span>
          {{ site.equipment.label }}
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.ENGAGEMENT }} mr-1"></i> Engagement :
          </span>
          {{ site.engagement.label }}
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.APPROACH_TIME }} mr-1"></i> Temps d'approche :
          </span>
          {{ site.approachTime }}
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.APPROACH_TYPE }} mr-1"></i> Type d'approche :
          </span>
          {{ site.approachType.label }}
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.ROUTE_FOOT }} mr-1"></i> Pied des voies :
          </span>
          {{ site.routeFoot.label }}
        </p>
      </div>
    </p-tabPanel>
    <p-tabPanel>
      <ng-template pTemplate="header">
        <span (click)="showMapMainParking()">
          <i class="{{ ICON.LOCATION }} mr-2"></i>Localisation</span
        >
      </ng-template>
      <ng-template pTemplate="content">
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.REGION }} mr-1"></i> Région :
          </span>
          {{ site.region.name }}
        </p>
        <p class="subtitle">
          <span [class]="textInfo">
            <i class="{{ ICON.DEPARTMENT }} mr-1"></i> Département :
          </span>
          {{ site.department.name }}
        </p>
        <app-map [mapOption]="mapOption"></app-map>
      </ng-template>
    </p-tabPanel>
    <p-tabPanel *ngIf="isLogged">
      <ng-template pTemplate="header">
        <span (click)="showMapSecondaryParking()">
          <i class="{{ ICON.VAN }} mr-2"></i>Parking camion</span
        >
      </ng-template>
      <ng-template pTemplate="content">
        <p class="subtitle">
          <span class="{{ site.network ? textInfo : textDanger }}">
            <i class="{{ ICON.NETWORK }} mr-1"></i>
            {{ site.network ? network : noNetwork }}
          </span>
        </p>
        <p class="subtitle">
          <span class="{{ site.wc ? textInfo : textDanger }}">
            <i class="{{ ICON.WC }} mr-1"></i>
            {{ site.wc ? wc : noWc }}
          </span>
        </p>
        <p class="subtitle">
          <span class="{{ site.water ? textInfo : textDanger }}">
            <i class="{{ ICON.WATER }} mr-1"></i>
            {{ site.water ? water : noWater }}
          </span>
        </p>
        <p class="subtitle">
          <span class="{{ site.river ? textInfo : textDanger }}">
            <i class="{{ ICON.RIVER }} mr-1"></i>
            {{ site.river ? river : noRiver }}
          </span>
        </p>
        <div class="is-flex is-justify-content-center">
          <app-map [mapOption]="mapOption"></app-map>
        </div>
      </ng-template>
    </p-tabPanel>
    <p-tabPanel>
      <ng-template pTemplate="header">
        <span> <i class="{{ ICON.SECTOR }} mr-2"></i>Secteurs</span>
      </ng-template>
      <p class="subtitle">
        <span [class]="textInfo">
          <i class="{{ ICON.SECTOR }} mr-1"></i> Nombre de secteurs :
        </span>
        {{ site.sectors.length }}
      </p>
      <p class="subtitle" *ngFor="let sector of site.sectors; let i = index">
        <span class="has-text-info"> Secteur {{ i + 1 }} : </span>
        {{ sector.name }}
      </p>
    </p-tabPanel>
    <p-tabPanel>
      <ng-template pTemplate="header">
        <span> <i class="{{ ICON.ROUTE }} mr-2"></i>Voies</span>
      </ng-template>
      <div *ngIf="routes.length === 0" class="has-text-centered">
        <p class="p-3 subtitle">Aucune voie enregistrée</p>
        <button
          pButton
          pRipple
          label="Ajouter une voie"
          [routerLink]="[routeNewUrl]"
          class="p-button p-button-outlined mt-5"></button>
      </div>
      <div *ngIf="routes.length > 0">
        <h2 class="subtitle has-text-centered">
          Nombre de voies referencées:
          <span class="has-text-info">{{ routes.length }}</span>
        </h2>
        <p-table
          [value]="routes"
          [loading]="loading"
          [paginator]="true"
          [rows]="25"
          styleClass="p-datatable-striped"
          sortField="level.label"
          [rowsPerPageOptions]="[25, 50, 100]">
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="name">
                Nom <p-sortIcon field="name"></p-sortIcon>
              </th>
              <th pSortableColumn="height">
                Hauteur <p-sortIcon field="height"></p-sortIcon>
              </th>
              <th pSortableColumn="level.label">
                Niveau <p-sortIcon field="level.label"></p-sortIcon>
              </th>
              <th pSortableColumn="secteur.name">
                Secteur <p-sortIcon field="secteur.name"></p-sortIcon>
              </th>
              <th pSortableColumn="secteur.name">
                Notes <p-sortIcon field="secteur.name"></p-sortIcon>
              </th>
              <th pSortableColumn="secteur.name" *ngIf="isLogged">Cochée</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-route>
            <tr>
              <td>
                <a [routerLink]="[routeViewUrl + route.id]">{{ route.name }}</a>
              </td>
              <td>{{ route.height }}</td>
              <td>{{ route.level.label }}</td>
              <td>{{ route.sector.name }}</td>
              <td>
                {{ getRating(route.id) }}
                <p-rating
                  [readonly]="true"
                  [stars]="getRating(route.id)"
                  [cancel]="false"></p-rating>
              </td>
              <td *ngIf="isLogged">
                <p-button styleClass="p-button-text"
                  ><i
                    class="{{
                      isChecked(route.id)
                        ? 'fas fa-check-circle has-text-success'
                        : 'far fa-circle has-text-black'
                    }} is-size-4"
                    (click)="
                      isChecked(route.id)
                        ? alreadyChecked()
                        : showDialog(route.id)
                    "></i
                ></p-button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </p-tabPanel>
    <p-tabPanel *ngIf="isLogged">
      <ng-template pTemplate="header">
        <span> <i class="{{ ICON.TOPO }} mr-2"></i>Topo</span>
      </ng-template>
    </p-tabPanel>
    <p-tabPanel *ngIf="isAdmin">
      <ng-template pTemplate="header">
        <a [routerLink]="[siteEditUrl + site.id]" [class]="textDanger">
          <i class="{{ ICON.EDIT }} mr-2"></i>Editer</a
        >
      </ng-template>
    </p-tabPanel>
    <p-tabPanel>
      <ng-template pTemplate="header">
        <a [routerLink]="[siteListUrl]" [class]="textInfo">
          <i class="{{ ICON.VAN }} mr-2"></i>Retour a la liste</a
        >
      </ng-template>
    </p-tabPanel>
  </p-tabView>
</div>
<app-notebook-form-dialog
  (isClose)="closeDialog()"
  (isSuccess)="reloadData()"
  [visible]="visible"
  [route]="selectedRoute"></app-notebook-form-dialog>
